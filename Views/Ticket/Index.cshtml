@model IEnumerable<NoSQLproject.Models.Ticket>

@{
    ViewData["Title"] = "All Tickets";
}

<div class="container mt-4">
    <h2 class="mb-4 fw-bold">Overview tickets</h2>

    <!-- Search + Navigation buttons -->
    <form method="get" class="d-flex justify-content-between align-items-center mb-3">
        <input type="text"
               name="searchEmail"
               value="@Context.Request.Query["searchEmail"]"
               class="form-control w-50"
               placeholder="Filter by email" />

        <div>
            <a asp-action="CurrentIncidents" class="btn btn-secondary me-2">CURRENT INCIDENTS</a>
            <a asp-action="Create" class="btn btn-success">CREATE INCIDENT</a>
        </div>
    </form>

    <!-- Tickets table -->
    <table class="table table-bordered table-hover align-middle">
        <thead class="table-light">
            <tr>
                <th>
                    <a asp-action="Index"
                       asp-route-sortOrder="@ViewData["IdSortParam"]"
                       asp-route-searchEmail="@Context.Request.Query["searchEmail"]"
                       class="text-decoration-none">ID</a>
                </th>
                <th>Subject</th>
                <th>
                    <a asp-action="Index"
                       asp-route-sortOrder="@ViewData["UserSortParam"]"
                       asp-route-searchEmail="@Context.Request.Query["searchEmail"]"
                       class="text-decoration-none">User</a>
                </th>
                <th>
                    <a asp-action="Index"
                       asp-route-sortOrder="@ViewData["DateSortParam"]"
                       asp-route-searchEmail="@Context.Request.Query["searchEmail"]"
                       class="text-decoration-none">Created</a>
                </th>
                <th>
                    <a asp-action="Index"
                       asp-route-sortOrder="@ViewData["DeadlineSortParam"]"
                       asp-route-searchEmail="@Context.Request.Query["searchEmail"]"
                       class="text-decoration-none">Deadline</a>
                </th>
                <th>Status</th>
            </tr>
        </thead>

        <tbody>
            @foreach (var ticket in Model)
            {
                <tr>
                    <td>@ticket.TicketNumber</td>
                    <td>@ticket.Title</td>
                    <td>
                        @ticket.CreatedBy?.FullName
                        <br />
                        <small class="text-muted">@ticket.CreatedBy?.Email</small>
                    </td>
                    <td>@ticket.CreatedAt.ToShortDateString()</td>
                    <td class="@(ticket.Deadline < DateTime.UtcNow ? "text-danger fw-bold" : "")">
                        @ticket.Deadline.ToShortDateString()
                    </td>
                    <td>@ticket.State</td>
                </tr>
            }
        </tbody>
    </table>
</div>
